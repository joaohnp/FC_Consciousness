# FC_Consciousness

This repository contains the analysis code for the research paper on functional connectivity and consciousness using Current-Based Decomposition (CURBD) of multi-region neural data.

## Overview

This project implements CURBD analysis to investigate brain-wide interactions across different sleep stages and behavioral states in rodents. The analysis pipeline includes:

1. **Initial CURBD computation** (`00.full_curbd_run.py`) - Computes CURBD estimates for each epoch across all animals
2. **Pilot analysis** (`01.curbd_simulations.py`) - Performs simulation-based validation
3. **Figure-specific analyses** - Individual scripts for generating each figure in the paper
4. **Statistical analyses** - H1 and H2 hypothesis testing pipelines

## Installation

This project uses [uv](https://docs.astral.sh/uv/) for dependency management. Install uv first:

```bash
# On macOS and Linux
curl -LsSf https://astral.sh/uv/install.sh | sh

After installing uv, set up the project:

```bash
# Clone the repository
git clone <repository-url>
cd FC_Consciousness

# Install dependencies
uv sync
```

## Usage

### Running Scripts

Use `uv run` to execute any script in the project:

```bash
# Run initial CURBD analysis
uv run src/curbd_analysis/scripts/initial_scripts/00.full_curbd_run.py

# Run pilot simulations
uv run src/curbd_analysis/scripts/initial_scripts/01.curbd_simulations.py

# Run figure-specific analyses
uv run src/curbd_analysis/analysis/fig2a_heatmap.py
uv run src/curbd_analysis/analysis/fig2b_rasterplot.py
# ... etc for other figures
```

### Analysis Pipeline

#### Step 1: Initial CURBD Computation

**Script**: `src/curbd_analysis/scripts/initial_scripts/00.full_curbd_run.py`

This is the first script to run. It:
- Processes neural data from all animals (r14, r16, r19, r20)
- Computes CURBD estimates for each epoch across different sessions:
  - Habituation
  - Fear Conditioning
  - Probe Test
  - Extinction Training
  - Extinction Test
- Analyzes different sleep stages (NREM, REM, AWAKE, QW)
- Outputs results to `data/curbd_output/results/` as pickle files

**Expected inputs**:
- Raw neural data in `data/raw/` directory
- Sleep scoring data in `data/SleepScores/`
- TTL/event data in `data/TTLs/`

**Outputs**:
- CURBD magnitude estimates for each session and animal
- Saved as pickle files in `data/CurbdMagnitudes/`

#### Step 2: Getting results of pilot analysis
**Script**: `src/curbd_analysis/scripts/initial_scripts/01.curbd_simulations.py`

This script performs simulation-based validation:
- Runs parallel simulations with varying neuron counts (4-12 total neurons)
- Validates CURBD estimates against simulated data
- Generates simulation outcome plots

**Expected inputs**:
- Simulation parameters in the script

**Outputs**:
- Simulation results in `data/pvar_analysis/`
- Figure 5 plots via `fig_5_plot_simulations_outcome.py`

#### Step 3: Statistical Analyses (H1 and H2)

Two hypothesis testing pipelines are available:

**H1 Analysis** (`src/curbd_analysis/scripts/H1_all_steps/`):
- Compares NREM vs AWAKE and NREM vs REM
- Steps:
  1. `step_1get_average_fc.py` - Compute average functional connectivity
  2. `step2_fraction_higher.py` - Fraction higher analysis
  3. `step3_combine_p.py` - Combine p-values
  4. `step_4_svm.py` - SVM classification analysis

**H2 Analysis** (`src/curbd_analysis/scripts/H2_all_steps/`):
- Focuses on NREM vs REM comparisons
- Similar stepwise analysis as H1

#### Step 4: Figure Generation

Each figure has a dedicated script in `src/curbd_analysis/analysis/`:

- `fig2a_heatmap.py` - Heatmap visualization
- `fig2b_rasterplot.py` - Raster plots
- `fig2c_curbd.py` - CURBD analysis plots
- `fig3a_active_raincloud.py` - Active state raincloud plots
- `fig3b_sem_neurons_baseline.py` - Baseline neuron SEM analysis
- `fig3c_baseline_raincloud.py` - Baseline raincloud plots
- `fig3d_sem_neurons_active.py` - Active neuron SEM analysis
- `fig6_pilot_analysis.py` - Pilot analysis visualization
- `fig7.py` through `fig11.py` - Additional figure analyses
- `fig_5_plot_simulations_outcome.py` - Simulation results

**Important**: Each figure script expects specific input files generated by the previous steps. Users may need to modify file paths in these scripts based on their actual data locations.

## Data Structure

### Required Data Organization

```
data/
├── raw/                    # Raw neural data
│   ├── r14/               # Animal r14 data
│   ├── r16/               # Animal r16 data
│   ├── r19/               # Animal r19 data
│   └── r20/               # Animal r20 data
├── SleepScores/           # Sleep stage scoring
├── TTLs/                  # Event timestamps
├── ChMaps/               # Channel mappings
└── curbd_output/         # Generated CURBD results
    └── results/
```

### Animal and Session Information

The project analyzes data from 4 animals (r14, r16, r19, r20) across 5 sessions:
1. **Habituation** - Baseline recording
2. **Fear Conditioning** - Learning phase
3. **Probe Test** - Memory recall
4. **Extinction Training** - Extinction learning
5. **Extinction Test** - Extinction recall

### Sleep Stages

- **NREM** - Non-REM sleep
- **REM** - REM sleep
- **AW** - Active wake
- **QW** - Quiet wake

## Dependencies

Key packages include:
- `numpy`, `pandas` - Data manipulation
- `matplotlib`, `seaborn` - Visualization
- `scipy`, `scikit-learn` - Scientific computing and ML
- `ptitprince` - Raincloud plots
- `scikit-posthocs` - Post-hoc statistical tests

## Custom Modules

- `curbd_analysis.analysis.curbd` - Core CURBD implementation
- `curbd_analysis.utils` - Utility functions
- `curbd_analysis.plotting` - Plotting utilities
- `curbd_analysis.io` - Input/output functions

## Notes for Users

1. **File Paths**: Many scripts contain hardcoded paths. Users should update these based on their data organization.
2. **Memory Requirements**: CURBD analysis can be memory-intensive for large datasets.
3. **Computation Time**: Initial CURBD computation may take several hours depending on dataset size.
4. **Dependencies**: All required packages are specified in `pyproject.toml` and installed via `uv sync`.


## License

This project is licensed under the terms specified in the LICENSE file.
